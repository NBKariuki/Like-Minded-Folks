<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0d0f14">
<title>Like-Minded Folks ¬∑ MMF</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Sora:wght@600;700;800&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">
<style>
:root {
  /* ‚îÄ‚îÄ Apple HIG Dynamic Type scale (rem-based so system font size is respected) ‚îÄ‚îÄ
     Base: 1rem = 16px (browser default). User bumping system font size to 20px
     makes 1rem = 20px automatically ‚Äî every size below scales with it.
     
     Scale mapped to Apple HIG text styles:
     --t-largetitle  ‚Üí 34pt  Large Title   (hero numbers, major displays)
     --t-title1      ‚Üí 28pt  Title 1       (section heroes)
     --t-title2      ‚Üí 22pt  Title 2       (card titles, alias name)
     --t-title3      ‚Üí 20pt  Title 3       (inner titles)
     --t-headline    ‚Üí 17pt  Headline      (primary labels, bold body)
     --t-body        ‚Üí 17pt  Body          (standard readable text)
     --t-callout     ‚Üí 16pt  Callout       (supporting body text)
     --t-subhead     ‚Üí 15pt  Subheadline   (secondary labels)
     --t-footnote    ‚Üí 13pt  Footnote      (metadata, timestamps)
     --t-caption1    ‚Üí 12pt  Caption 1     (table headers, tags)
     --t-caption2    ‚Üí 11pt  Caption 2     (smallest labels)
  */
  --t-largetitle: 2.125rem;   /* 34pt */
  --t-title1:     1.75rem;    /* 28pt */
  --t-title2:     1.375rem;   /* 22pt */
  --t-title3:     1.25rem;    /* 20pt */
  --t-headline:   1.0625rem;  /* 17pt ‚Äî same size as body, but bold */
  --t-body:       1.0625rem;  /* 17pt */
  --t-callout:    1rem;       /* 16pt */
  --t-subhead:    0.9375rem;  /* 15pt */
  --t-footnote:   0.8125rem;  /* 13pt */
  --t-caption1:   0.75rem;    /* 12pt */
  --t-caption2:   0.6875rem;  /* 11pt */

  /* Accent & semantic colours ‚Äî same in both modes */
  --ac:  #00c87a;
  --acl: rgba(0,200,122,.13);
  --bl:  #3b82f6;
  --bll: rgba(59,130,246,.13);
  --gd:  #f59e0b;
  --gdl: rgba(245,158,11,.13);
  --rd:  #ef4444;
  --tr:  .25s ease;
}

/* ‚îÄ‚îÄ DARK MODE ‚Äî follows system preference automatically (Apple HIG) ‚îÄ‚îÄ */
@media (prefers-color-scheme: dark) {
  :root {
    --bg:   #0d0f14;
    --card: #181c26;
    --card2:#1e2232;
    --br:   rgba(255,255,255,.07);
    --br2:  rgba(255,255,255,.14);
    --t1:   #eef0f8;
    --t2:   rgba(238,240,248,.6);
    --t3:   rgba(238,240,248,.32);
    --sh:   0 4px 24px rgba(0,0,0,.45);
    --shl:  0 8px 40px rgba(0,0,0,.55);
    --ibg:  rgba(255,255,255,.05);
    --swbg: rgba(255,255,255,.1);
  }
}

/* ‚îÄ‚îÄ LIGHT MODE ‚Äî follows system preference automatically (Apple HIG) ‚îÄ‚îÄ */
@media (prefers-color-scheme: light) {
  :root {
    --bg:   #f0f4f2;
    --card: #fff;
    --card2:#f7faf8;
    --br:   rgba(0,0,0,.07);
    --br2:  rgba(0,0,0,.13);
    --t1:   #111827;
    --t2:   rgba(17,24,39,.6);
    --t3:   rgba(17,24,39,.35);
    --sh:   0 4px 24px rgba(0,0,0,.08);
    --shl:  0 8px 40px rgba(0,0,0,.13);
    --ibg:  rgba(0,0,0,.04);
    --swbg: rgba(0,0,0,.1);
  }
}

/* ‚îÄ‚îÄ MANUAL OVERRIDE ‚Äî user can force light/dark via data-theme attribute ‚îÄ‚îÄ
   This lets us keep the toggle as a secondary override without it being
   the primary mechanism. System preference always wins unless overridden. */
[data-theme=dark] {
  --bg:#0d0f14;--card:#181c26;--card2:#1e2232;
  --br:rgba(255,255,255,.07);--br2:rgba(255,255,255,.14);
  --t1:#eef0f8;--t2:rgba(238,240,248,.6);--t3:rgba(238,240,248,.32);
  --sh:0 4px 24px rgba(0,0,0,.45);--shl:0 8px 40px rgba(0,0,0,.55);
  --ibg:rgba(255,255,255,.05);--swbg:rgba(255,255,255,.1);
}
[data-theme=light] {
  --bg:#f0f4f2;--card:#fff;--card2:#f7faf8;
  --br:rgba(0,0,0,.07);--br2:rgba(0,0,0,.13);
  --t1:#111827;--t2:rgba(17,24,39,.6);--t3:rgba(17,24,39,.35);
  --sh:0 4px 24px rgba(0,0,0,.08);--shl:0 8px 40px rgba(0,0,0,.13);
  --ibg:rgba(0,0,0,.04);--swbg:rgba(0,0,0,.1);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LIGHT MODE COMPONENT OVERRIDES
   All components below use hardcoded rgba values tuned
   for dark backgrounds ‚Äî these rules correct them for light.
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@media (prefers-color-scheme: light) {
  /* Pill nav track ‚Äî dark glass ‚Üí light frosted */
  .nav-track {
    background: rgba(0,0,0,.05);
    border-color: rgba(0,0,0,.1);
  }
  /* Active tab text colours already fine via CSS vars;
     just ensure the inactive pill text is readable */
  .tab { color: rgba(17,24,39,.45); }

  /* Hero pill ‚Äî green stays but darkened for legibility */
  .hero-pill { color: #009958; border-color: rgba(0,153,88,.3); background: rgba(0,153,88,.1); }

  /* Glass action cards ‚Äî white base instead of white-on-dark */
  .qac {
    background: rgba(255,255,255,.7);
    border-color: rgba(0,0,0,.08);
    box-shadow: 0 2px 16px rgba(0,0,0,.07);
  }
  .qac-ico {
    background: rgba(0,0,0,.05);
    border-color: rgba(0,0,0,.08);
  }
  .qac-lbl { color: rgba(17,24,39,.75); }
  .qac-arr  { color: rgba(17,24,39,.3); }

  /* Card 1 ‚Äî blue tint on light */
  .qac1 { background: rgba(59,130,246,.07); border-color: rgba(59,130,246,.18); }
  .qac1 .qac-ico { background: rgba(59,130,246,.1); border-color: rgba(59,130,246,.2); }
  .qac1 .qac-lbl { color: #1d4ed8; }

  /* Card 2 ‚Äî green tint on light */
  .qac2 { background: rgba(0,160,100,.07); border-color: rgba(0,160,100,.18); }
  .qac2 .qac-ico { background: rgba(0,160,100,.1); border-color: rgba(0,160,100,.2); }
  .qac2 .qac-lbl { color: #047857; }

  /* Group Performance card */
  .perf-card {
    background: #fff;
    border-color: rgba(0,160,100,.15);
    box-shadow: 0 4px 24px rgba(0,0,0,.07);
  }
  .perf-ico  { background: rgba(0,160,100,.08); border-color: rgba(0,160,100,.18); }
  .perf-title{ color: rgba(17,24,39,.55); }
  .perf-n.int{ color: rgba(17,24,39,.8); }
  .perf-n.bal{ color: #009958; text-shadow: 0 0 20px rgba(0,153,88,.2); }
  .perf-lbl  { color: rgba(17,24,39,.35); }
  .perf-div  { background: rgba(0,0,0,.07); }
}

/* Same overrides for manual data-theme=light toggle */
[data-theme=light] .nav-track {
  background: rgba(0,0,0,.05); border-color: rgba(0,0,0,.1);
}
[data-theme=light] .tab { color: rgba(17,24,39,.45); }
[data-theme=light] .hero-pill { color:#009958; border-color:rgba(0,153,88,.3); background:rgba(0,153,88,.1); }
[data-theme=light] .qac { background:rgba(255,255,255,.7); border-color:rgba(0,0,0,.08); box-shadow:0 2px 16px rgba(0,0,0,.07); }
[data-theme=light] .qac-ico { background:rgba(0,0,0,.05); border-color:rgba(0,0,0,.08); }
[data-theme=light] .qac-lbl { color:rgba(17,24,39,.75); }
[data-theme=light] .qac-arr  { color:rgba(17,24,39,.3); }
[data-theme=light] .qac1 { background:rgba(59,130,246,.07); border-color:rgba(59,130,246,.18); }
[data-theme=light] .qac1 .qac-ico { background:rgba(59,130,246,.1); border-color:rgba(59,130,246,.2); }
[data-theme=light] .qac1 .qac-lbl { color:#1d4ed8; }
[data-theme=light] .qac2 { background:rgba(0,160,100,.07); border-color:rgba(0,160,100,.18); }
[data-theme=light] .qac2 .qac-ico { background:rgba(0,160,100,.1); border-color:rgba(0,160,100,.2); }
[data-theme=light] .qac2 .qac-lbl { color:#047857; }
[data-theme=light] .perf-card { background:#fff; border-color:rgba(0,160,100,.15); box-shadow:0 4px 24px rgba(0,0,0,.07); }
[data-theme=light] .perf-ico  { background:rgba(0,160,100,.08); border-color:rgba(0,160,100,.18); }
[data-theme=light] .perf-title{ color:rgba(17,24,39,.55); }
[data-theme=light] .perf-n.int{ color:rgba(17,24,39,.8); }
[data-theme=light] .perf-n.bal{ color:#009958; text-shadow:0 0 20px rgba(0,153,88,.2); }
[data-theme=light] .perf-lbl  { color:rgba(17,24,39,.35); }
[data-theme=light] .perf-div  { background:rgba(0,0,0,.07); }
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
/* Setting font-size:100% means 1rem = user's system font size preference.
   If user has set "Larger Text" in iOS Settings ‚Üí Accessibility, this respects it. */
html{font-size:100%;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);min-height:100svh;overscroll-behavior:none;transition:background var(--tr),color var(--tr);}
button,select,input{touch-action:manipulation;font-family:inherit;}

.pw-screen{min-height:100svh;display:flex;align-items:center;justify-content:center;padding:24px;}
.pw-card{background:var(--card);border:1px solid var(--br2);border-radius:28px;padding:40px 32px;width:100%;max-width:360px;box-shadow:var(--shl);display:flex;flex-direction:column;align-items:center;gap:6px;}
.pw-title{font-family:'Sora',sans-serif;font-size:var(--t-title2);font-weight:800;margin-top:6px;}
.pw-sub{font-size:var(--t-footnote);color:var(--t3);margin-bottom:16px;text-align:center;}
.pw-inp{width:100%;padding:13px 16px;background:var(--ibg);border:1px solid var(--br2);border-radius:14px;color:var(--t1);font-size:var(--t-callout);outline:none;transition:border-color .2s;}
.pw-inp:focus{border-color:var(--ac);}
.pw-inp.err{border-color:var(--rd);}
.pw-err{color:var(--rd);font-size:var(--t-footnote);min-height:18px;align-self:flex-start;}
.pw-btn{width:100%;padding:14px;background:var(--ac);color:#fff;border:none;border-radius:14px;font-size:var(--t-callout);font-weight:700;cursor:pointer;margin-top:4px;}
.pw-help{font-size:var(--t-caption1);color:var(--t3);text-align:center;margin-top:8px;}

.shell{max-width:430px;margin:0 auto;min-height:100svh;display:flex;flex-direction:column;overflow-x:hidden;}
.hdr{padding:20px 20px 0;}
.hdr-row{display:flex;justify-content:space-between;align-items:flex-start;}
.eyebrow{font-size:var(--t-caption2);font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--ac);}
.title{font-family:'Sora',sans-serif;font-size:var(--t-title1);font-weight:800;letter-spacing:-.02em;}
.subtitle{font-size:var(--t-footnote);color:var(--t2);margin-top:2px;}
.sw{width:52px;height:28px;border-radius:20px;background:var(--swbg);border:1px solid var(--br2);cursor:pointer;display:flex;align-items:center;padding:3px;flex-shrink:0;transition:background .25s;}
.knob{width:22px;height:22px;border-radius:50%;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:var(--t-caption1);box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .25s;}
[data-theme=light] .knob{transform:translateX(24px);}
[data-theme=light] .sw{background:var(--acl);border-color:var(--ac);}

.greet{padding:22px 20px 10px;}
.greet-line{font-size:var(--t-subhead);font-weight:500;line-height:1.4;color:var(--t1);letter-spacing:.01em;}


/* ‚îÄ‚îÄ Pill Nav ‚îÄ‚îÄ */
.nav-wrap{padding:14px 16px 0;position:sticky;top:0;z-index:50;background:var(--bg);}
.nav-track{display:flex;gap:4px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);border-radius:50px;padding:4px;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);}
.tab{flex:1;text-align:center;padding:9px 6px;border-radius:50px;color:var(--t3);font-size:var(--t-footnote);font-weight:700;cursor:pointer;white-space:nowrap;transition:all .22s;border:none;background:transparent;letter-spacing:.01em;}
.tab-ov.on{background:#00c87a;color:#001a0e;box-shadow:0 2px 12px rgba(0,200,122,.35);}
.tab-bl.on{background:#3b82f6;color:#fff;box-shadow:0 2px 12px rgba(59,130,246,.35);}
.tab-mo.on{background:#8b5cf6;color:#fff;box-shadow:0 2px 12px rgba(139,92,246,.35);}


.panel{display:none;padding-bottom:80px;}
.panel.on{display:block;animation:up .3s ease;}

.hero{padding:28px 20px 10px;text-align:center;}
.hero-lbl{font-size:var(--t-caption1);font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--t3);margin-bottom:8px;}
.hero-num{font-family:'Sora',sans-serif;font-size:var(--t-largetitle);font-weight:800;line-height:1;letter-spacing:-.04em;color:var(--t1);}
.hero-sub{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:10px;font-size:var(--t-footnote);color:var(--t3);}
.hero-pill{background:rgba(0,200,122,.12);color:#00e5a0;padding:4px 12px;border-radius:20px;font-size:var(--t-caption1);font-weight:700;border:1px solid rgba(0,229,160,.25);letter-spacing:.02em;}

/* ‚îÄ‚îÄ Quick-action glass cards (side by side) ‚îÄ‚îÄ */
.qarow{display:flex;gap:10px;padding:14px 16px 0;}
.qac{flex:1;border-radius:18px;padding:16px 14px;display:flex;flex-direction:column;align-items:center;gap:10px;cursor:pointer;transition:transform .15s,opacity .15s;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  box-shadow:0 2px 16px rgba(0,0,0,.2);}
.qac:active{transform:scale(.96);opacity:.85;}
.qac-ico{width:40px;height:40px;border-radius:12px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:var(--t-headline);}
.qac-lbl{font-family:'Sora',sans-serif;font-size:var(--t-footnote);font-weight:700;color:rgba(238,240,248,.8);line-height:1.3;text-align:center;}
.qac-arr{font-size:var(--t-caption1);color:rgba(238,240,248,.3);}
/* subtle tint per card */
.qac1{background:rgba(59,130,246,.06);border-color:rgba(91,163,246,.14);}
.qac1 .qac-ico{background:rgba(59,130,246,.1);border-color:rgba(91,163,246,.18);}
.qac1 .qac-lbl{color:rgba(180,210,255,.75);}
.qac2{background:rgba(0,200,122,.06);border-color:rgba(0,200,122,.14);}
.qac2 .qac-ico{background:rgba(0,200,122,.1);border-color:rgba(0,200,122,.18);}
.qac2 .qac-lbl{color:rgba(180,245,220,.75);}

/* ‚îÄ‚îÄ Group Performance card ‚îÄ‚îÄ */
.perf-card{margin:14px 16px 0;border-radius:22px;padding:20px 18px 24px;
  background:#0f1410;border:1px solid rgba(0,200,122,.14);
  box-shadow:0 4px 24px rgba(0,0,0,.4);}
.perf-head{display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:18px;}
.perf-ico{width:36px;height:36px;border-radius:10px;background:rgba(0,200,122,.09);border:1px solid rgba(0,200,122,.2);display:flex;align-items:center;justify-content:center;font-size:var(--t-headline);}
.perf-title{font-family:'Sora',sans-serif;font-size:var(--t-subhead);font-weight:700;color:rgba(238,240,248,.6);text-align:center;}
.perf-nums{display:flex;flex-direction:column;gap:14px;}
.perf-row{display:flex;flex-direction:column;align-items:center;gap:2px;}
.perf-n{font-family:'Sora',sans-serif;font-weight:800;line-height:1;letter-spacing:-.02em;text-align:center;}
.perf-n.int{font-size:var(--t-title2);color:rgba(238,240,248,.75);}
.perf-n.bal{font-size:var(--t-title1);color:#00e5a0;letter-spacing:-.03em;text-shadow:0 0 28px rgba(0,229,160,.3);}
.perf-lbl{font-size:var(--t-caption2);font-weight:600;color:rgba(238,240,248,.28);text-transform:uppercase;letter-spacing:.08em;text-align:center;}
.perf-div{height:1px;background:rgba(255,255,255,.06);margin:0 4px;}

.inner{padding:0 20px;animation:up .25s ease;}
.back-btn{display:flex;align-items:center;gap:8px;padding:14px 0 10px;color:var(--t2);font-size:var(--t-subhead);font-weight:600;cursor:pointer;background:transparent;border:none;}
.inner-title{font-family:'Sora',sans-serif;font-size:var(--t-title3);font-weight:800;margin-bottom:14px;}
.ccrd{background:var(--card);border:1px solid var(--br);border-radius:20px;padding:16px;margin-bottom:14px;box-shadow:var(--sh);}
.clbl{font-size:var(--t-caption1);font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);margin-bottom:2px;}
.csub{font-size:var(--t-caption1);color:var(--t3);margin-bottom:10px;}

.mtbl-wrap{background:var(--card);border:1px solid var(--br);border-radius:20px;overflow:hidden;box-shadow:var(--sh);margin-bottom:12px;}
.mtbl{width:100%;border-collapse:collapse;font-size:var(--t-caption1);table-layout:fixed;}
.mtbl thead{background:var(--card2);}
.mtbl th{padding:7px 5px;text-align:right;color:var(--t3);font-size:var(--t-caption2);font-weight:700;text-transform:uppercase;letter-spacing:.04em;border-bottom:1px solid var(--br);white-space:nowrap;overflow:hidden;}
.mtbl th.tl{text-align:left;}
.mtbl td{padding:7px 5px;text-align:right;border-bottom:1px solid var(--br);color:var(--t2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.mtbl td.tl{text-align:left;}
.mtbl tbody tr:last-child td{border-bottom:none;}
.mtbl .tot td{background:var(--card2);color:var(--t1);font-weight:700;border-top:1px solid var(--br2);border-bottom:none;}
.nm{font-family:'JetBrains Mono',monospace;font-size:var(--t-caption1);}
.ac{color:var(--ac)!important;font-weight:700!important;}
.tcell{display:flex;align-items:center;justify-content:flex-end;gap:5px;}
.dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.dts{font-size:var(--t-caption2);color:var(--t3);text-align:center;padding:8px 0;}

.bpad{padding:16px 20px 0;}
.mscroll{display:flex;gap:7px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;margin-bottom:16px;}
.mscroll::-webkit-scrollbar{display:none;}
.mpill{padding:7px 14px;border-radius:20px;border:1px solid var(--br2);background:transparent;color:var(--t3);font-size:var(--t-footnote);font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:all .15s;}
.mpill.on{background:var(--ac);color:#fff;border-color:var(--ac);}
.acrd{background:var(--card);border:1px solid var(--br2);border-radius:20px;padding:16px;margin-bottom:14px;box-shadow:var(--sh);}
.albl{font-size:var(--t-caption2);font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);margin-bottom:8px;}
.asel{width:100%;padding:12px 14px;background:var(--ibg);border:1px solid var(--br2);border-radius:14px;color:var(--t1);font-family:'DM Sans',sans-serif;font-size:var(--t-subhead);font-weight:600;outline:none;cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='rgba(150,150,170,.6)' d='M0 0l6 8 6-8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px;}
.asel:focus{border-color:var(--ac);}
.asel option{background:var(--card);}
.scrd{background:var(--card);border:1px solid var(--br);border-radius:20px;padding:20px;margin-bottom:14px;box-shadow:var(--sh);}
.s-alias{font-family:'Sora',sans-serif;font-size:var(--t-title2);font-weight:800;margin-bottom:2px;}
.s-month{font-size:var(--t-footnote);color:var(--t3);margin-bottom:18px;}
.srow{display:flex;justify-content:space-between;align-items:center;padding:11px 0;border-bottom:1px solid var(--br);}
.srow:last-child{border-bottom:none;padding-bottom:0;}
.slbl{font-size:var(--t-subhead);color:var(--t2);}
.sval{font-family:'JetBrains Mono',monospace;font-size:var(--t-subhead);font-weight:600;color:var(--t1);}
.sval.bl{color:var(--bl);}
.sval.gr{color:var(--ac);}
.sval.hero{font-size:var(--t-title2);color:var(--ac);font-family:'Sora',sans-serif;font-weight:800;}
.slbl.big{font-size:var(--t-subhead);font-weight:700;color:var(--t1);}
.hint{font-size:var(--t-caption2);color:var(--gd);margin-top:2px;}
.sts{font-size:var(--t-caption2);color:var(--t3);text-align:right;margin-top:10px;}
.wcrd{background:var(--gdl);border:1px solid rgba(245,158,11,.2);border-radius:14px;padding:14px 16px;margin-bottom:14px;display:flex;gap:12px;}
.wtitle{font-size:var(--t-footnote);font-weight:700;color:var(--gd);margin-bottom:3px;}
.wbody{font-size:var(--t-footnote);color:var(--t2);line-height:1.5;}
.mcrd{background:var(--card);border:1px solid var(--br);border-radius:20px;padding:16px;margin-bottom:14px;display:flex;gap:12px;align-items:flex-start;box-shadow:var(--sh);}
.mico{font-size:1.4rem;flex-shrink:0;}
.mtxt{font-size:var(--t-subhead);color:var(--t2);line-height:1.6;}
.empty{text-align:center;padding:40px 20px;color:var(--t3);font-size:var(--t-subhead);}

.morepad{padding:16px 20px 0;display:flex;flex-direction:column;gap:12px;}
.morecrd{background:var(--card);border:1px solid var(--br);border-radius:20px;overflow:hidden;box-shadow:var(--sh);}
.morehead{padding:13px 16px;border-bottom:1px solid var(--br);font-size:var(--t-caption1);font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--ac);}
.morebody{padding:14px 16px;}
.dep{background:var(--ibg);border:1px solid var(--br);border-radius:14px;padding:12px;margin-bottom:8px;}
.dep:last-child{margin-bottom:0;}
.dep-t{font-size:var(--t-caption1);font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--bl);margin-bottom:6px;}
.dep-i{font-size:var(--t-footnote);color:var(--t2);line-height:1.7;}
.dep-i strong{color:var(--t1);font-family:'JetBrains Mono',monospace;font-size:.82rem;}
.dep-w{margin-top:8px;padding:8px 10px;background:var(--gdl);border:1px solid rgba(245,158,11,.2);border-radius:8px;font-size:var(--t-caption1);color:var(--gd);line-height:1.4;}
.rlist{list-style:none;}
.rlist li{display:flex;align-items:flex-start;gap:8px;padding:6px 0;border-bottom:1px solid var(--br);font-size:var(--t-subhead);color:var(--t2);line-height:1.5;}
.rlist li:last-child{border-bottom:none;}
.rlist li::before{content:'‚Äî';color:var(--ac);font-weight:700;flex-shrink:0;}
.rlist strong{color:var(--t1);}
.pdf-pw{font-size:var(--t-caption2);color:var(--gd);margin-bottom:8px;text-align:right;}
.ssel{width:100%;padding:11px 13px;background:var(--acl);color:var(--ac);border:1px solid rgba(0,200,122,.22);border-radius:14px;font-family:'DM Sans',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;outline:none;-webkit-appearance:none;appearance:none;}
.ssel option{background:var(--card);color:var(--t1);}
.priv{margin:16px 20px 0;padding:12px 14px;background:var(--gdl);border:1px solid rgba(245,158,11,.18);border-radius:14px;font-size:var(--t-footnote);color:var(--t2);line-height:1.5;text-align:center;}
.priv strong{color:var(--t1);}

.lscreen{min-height:100svh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:var(--t3);font-size:var(--t-subhead);}
.spin{width:32px;height:32px;border:3px solid var(--br2);border-top-color:var(--ac);border-radius:50%;animation:rot .7s linear infinite;}
@keyframes up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
@keyframes rot{to{transform:rotate(360deg)}}
@keyframes shk{0%,100%{transform:none}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

const MEMBERS = [
  'Tokyo','Berlin','Gandia','Denver','Helsinki','Oslo','Moscow',
  'California','Lisbon','Stockholm','Paris','Marseille','Rio','Nairobi',
  'Tel Aviv','Valencia','Havana','Manilla','Scofield','Bogota',
  'Emirates','Dublin','Doha','Bern'
];
const MONTHS = ['January','February','March','April','May','June',
  'July','August','September','October','November','December'];

const URLS = [
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTE4ODE3NjExNTQmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTExODIwNzc2Mjcmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTExNDkyMjYwMjQmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTk2MjExMTcwNCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTUxNDQ5Mjc4MiZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTU5OTQ2MTg1NyZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTcwMzc5MjUzMCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTIwOTM3MDg5Nzkmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTEwNzkyMzcwNDMmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTM2MjM4OTY0MCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTM1MDMxNTkyMiZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
  "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTEwMTY1NjE3OTgmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg=="
];
const MONTH_URLS = {};
MONTHS.forEach((m,i) => { MONTH_URLS[m] = atob(URLS[i]); });

const MIN_CONTRIB          = 4000;
const MINIMUM_CONTRIBUTION = 4000;
const ETICA_MONTHLY        = 0.12 / 12;
const ETICA_MONTHLY_YIELD  = 0.12 / 12;
const WARN_START_DAY       = 10;
const PASSWORD             = 'LikeMinded2026';
const AUTH_DAYS            = 30;
const CUR_YEAR             = new Date().getFullYear();
const PAIRS = {
  'California':'Lisbon','Lisbon':'California',
  'Paris':'Marseille','Marseille':'Paris'
};

const INSPIRATIONS = [
  "Small, consistent steps build extraordinary wealth.",
  "Every contribution today is a gift to your future self.",
  "Saving together multiplies what we could never do alone.",
  "Discipline today. Freedom tomorrow.",
  "Wealth is built every single day.",
  "Consistency is the most underrated financial strategy.",
  "Your commitment is an investment in yourself.",
];

function greetLine() {
  const h = new Date().getHours();
  const time = h < 12 ? 'Good morning' : h < 17 ? 'Good afternoon' : 'Good evening';
  const quotes = INSPIRATIONS;
  const quote = quotes[Math.floor(Date.now()/(1000*60*60*3)) % quotes.length];
  return `${time} ‚Äî ${quote}`;
}
function curMonth() { return MONTHS[new Date().getMonth()]; }

function getAuth() {
  try {
    const r = localStorage.getItem('mmf_auth');
    if (!r) return null;
    const t = JSON.parse(r);
    if (Date.now() > t.exp) { localStorage.removeItem('mmf_auth'); return null; }
    return t;
  } catch(e) { return null; }
}
function setAuth() {
  localStorage.setItem('mmf_auth', JSON.stringify({ok:true, exp: Date.now() + AUTH_DAYS*86400000}));
}

function parseRow(line) {
  const r=[]; let cur='', inQ=false;
  for (const ch of line) {
    if (ch==='"') inQ=!inQ;
    else if (ch===',' && !inQ) { r.push(cur); cur=''; }
    else cur+=ch;
  }
  r.push(cur); return r;
}

const PARTIAL_CONTRIBUTION_MESSAGES = [
            (a,r) => `Hey there! üëã You've put in KES ${a.toLocaleString()} this month. Just KES ${r.toLocaleString()} more and you're all set for interest. You've got this! üí™`,
            (a,r) => `Nice start! üåü You're at KES ${a.toLocaleString()} so far. Top up KES ${r.toLocaleString()} more to unlock this month's interest. Almost there!`,
            (a,r) => `Good progress! üéØ Your KES ${a.toLocaleString()} is working. Add KES ${r.toLocaleString()} more to hit the minimum and earn interest. Keep going!`,
            (a,r) => `You're on the right track! üöÄ KES ${a.toLocaleString()} down, KES ${r.toLocaleString()} to go. Top up soon!`,
            (a,r) => `Almost there! üòä You've contributed KES ${a.toLocaleString()}. Just KES ${r.toLocaleString()} more to qualify for interest this month!`
        ];

const ARCHETYPE_MESSAGES = {
            OVERACHIEVER: [
                { icon: 'üèÜ', text: "You're in the top 3! At this pace, you're on track for **{projected}** by December. Your early deposits are earning you way more interest than late contributors." },
                { icon: 'üíé', text: "Star performer! You've earned **{interest}** in interest so far. Keep this up!" },
                { icon: 'üöÄ', text: "Your balance is growing faster than **{percentBeaten}%** of the group. December projection: **{projected}**." },
                { icon: 'üî•', text: "On fire! You're projected to hit **{projected}** by December. **{stretchGoal}** is totally within reach." },
                { icon: 'üëë', text: "Top tier! You've contributed **{totalTopups}** so far. December you will have **{projected}**. That's a serious emergency fund." },
            ],
            STEADY_CLIMBER: [
                { icon: 'üå±', text: "Solid progress! Projected **{projected}** by December. Just **KES 1,000 more/month** pushes that to **{stretchGoal}**." },
                { icon: 'üí™', text: "Consistent wins! If you deposited **3 days earlier** each month, you'd earn **KES 200+ more interest** by December." },
                { icon: 'üìà', text: "Steady climb! Your average deposit is **{avgDeposit}**/month. December: **{projected}** with **{projectedInterest}** in interest." },
                { icon: 'üö∂', text: "One step at a time! On track for **{projected}** by December. **{monthsLeft}** months of steady contributions away." },
                { icon: 'üéä', text: "You're doing great! **{percentBeaten}%** of members are behind you. Keep going and you'll crack **{projected}** by December." }
            ],
            LATE_BLOOMER: [
                { icon: 'üî•', text: "Look at you go! From **{previousMonthTopup}** last month to **{currentMonthTopup}** this month. Keep this momentum and you'll hit **{projected}** by December." },
                { icon: 'üåÖ', text: "Late bloomer alert! You're gaining speed. **{avgDeposit}**/month ‚Üí **{projected}** by year-end." },
                { icon: 'üìà', text: "Upward trajectory! Last: **{previousMonthTopup}**. Now: **{currentMonthTopup}**. Next month? Hit **{suggestedNextDeposit}** and you're on a roll." },
                { icon: 'üéØ', text: "You're catching up fast! **{totalTopups}** total ‚Üí **{projected}** by December. That's real money!" },
                { icon: 'üéâ', text: "Progress party! You've more than doubled your deposit this month. December: **{projected}**." }
            ],
            PARTIAL_CONTRIBUTOR: [
                { icon: 'üéØ', text: "You've put in {currentMonthTopup} this month. Just {gapToMinimum} away from qualifying for interest. Doable!" },
                { icon: 'üíö', text: "Good news: {similarMembers} members started at your level and hit the minimum by month-end. Just {gapToMinimum} more!" },
                { icon: '‚è∞', text: "You still have time left in the month. {gapToMinimum} is all you need to qualify for interest." },
                { icon: 'üå±', text: "Every shilling counts! Add {gapToMinimum} more and you'll earn interest this month." },
                { icon: 'üí™', text: "You're {gapToMinimum} away from interest. Hit it and you'll start earning on {currentBalance}." }
            ],
            GHOST: [
                { icon: 'üëã', text: "It's not too late! Start with just {minimum} this month. By December, that becomes real money plus interest." },
                { icon: '‚è∞', text: "Every month you wait costs you growth. Deposit {minimum} now and December you will thank today you." },
                { icon: 'üí™', text: "No judgment, just math: {minimum}/month for {monthsLeft} months = {lateStartProjection} by December. Still worth it!" },
                { icon: 'üéØ', text: "Your seat is still warm! Deposit {minimum} this month. Even starting late, you'll have {lateStartProjection} by year-end." },
                { icon: '‚ú®', text: "The best time to start was January. The second best time is today. {minimum} gets you in the game." }
            ],
            EARLY_BIRD: [
                { icon: 'üê¶', text: "Early bird gets the interest! Your deposit is earning more than late-month deposits. December: **{projected}**!" },
                { icon: '‚è∞', text: "Perfect timing! You're earning more interest than average just by depositing early. That's free money for good habits." },
                { icon: 'üéØ', text: "Nailed it! Early deposits mean more earning days. On track for **{projected}** by December." },
                { icon: 'üíé', text: "Premium timing! You're maximizing interest by depositing early. December you: **{projected}**." },
            ],
            BIG_DEPOSITOR: [
                { icon: 'üêã', text: "Whale alert! Your {currentBalance} is the group's backbone. Projected {projected} by December." },
                { icon: 'üëë', text: "Your {avgDeposit}/month is above average. December you: {projected}. Respect!" },
                { icon: 'üåü', text: "Star power! Your {totalTopups} in contributions are setting the pace. Projected {projected} by December." },
            ],
            ACCELERATOR: [
                { icon: 'üöÄ', text: "Momentum builder! From {previousMonthTopup} to {currentMonthTopup} this month. Keep this and you'll blow past {projected}!" },
                { icon: 'üìà', text: "You're scaling up! Deposits growing {percentIncrease}% month-over-month. December could surprise with {stretchGoal}." },
                { icon: 'üî•', text: "On fire! Contributions jumped from {previousMonthTopup} to {currentMonthTopup}. Hit {stretchGoal} by year-end." },
            ],
            STEADY_CONTRIBUTOR: [
                { icon: 'üéØ', text: "Consistency wins! You've hit {avgDeposit} like clockwork. December: {projected}." },
                { icon: '‚öôÔ∏è', text: "Autopilot mode. Your steady {avgDeposit}/month is compounding nicely. By December: {projected}+." },
                { icon: 'üèÜ', text: "Steady wins the race. {avgDeposit} deposits earning you {projected} by year-end." }
            ],
            DECELERATOR: [
                { icon: '‚ö†Ô∏è', text: "Heads up! You dropped from {previousMonthTopup} to {currentMonthTopup} this month. Try to get back on track." },
                { icon: 'üí°', text: "Your balance is still growing, but slower. Bump back to {suggestedNextDeposit}/month to hit {projected}." },
                { icon: 'üõ§Ô∏è', text: "You're slipping a bit. Get back to {minimum}+ and December you hits {projected}." }
            ],
            VOLATILE: [
                { icon: 'üé¢', text: "Rollercoaster rider! Try smoothing to {avgDeposit} consistently for better growth to {projected}." },
                { icon: 'üé≤', text: "Wildcard! Aim for {minimum}+ steadily to maximize compound interest." },
            ]
        };

function calculateMemberArchetype(memberData, allMembersData, currentMonth) {
            const { totalTopups, currentMonthTopup, closingBalance, daysActive, previousMonthTopup } = memberData;
            const monthIndex = MONTHS.indexOf(currentMonth);
            const monthsElapsed = monthIndex + 1;
            const sortedMembers = [...allMembersData].sort((a,b) => b.closingBalance - a.closingBalance);
            const rank = sortedMembers.findIndex(m => m.closingBalance === closingBalance) + 1;
            if (totalTopups === 0) return 'GHOST';
            if (currentMonthTopup > 0 && currentMonthTopup < MINIMUM_CONTRIBUTION) return 'PARTIAL_CONTRIBUTOR';
            if (monthIndex > 0 && previousMonthTopup !== undefined) {
                const trendChange  = currentMonthTopup - previousMonthTopup;
                const trendPercent = previousMonthTopup > 0 ? (trendChange / previousMonthTopup) * 100 : 0;
                if (Math.abs(trendPercent) > 50 && monthIndex > 1) return 'VOLATILE';
                if (trendChange > 0 && trendPercent > 20) return 'ACCELERATOR';
                if (trendChange < 0 && trendPercent < -20 && currentMonthTopup >= MINIMUM_CONTRIBUTION) return 'DECELERATOR';
            }
            const avgDeposit = monthsElapsed > 0 ? totalTopups / monthsElapsed : 0;
            if (rank <= 3 && closingBalance > 0) return 'OVERACHIEVER';
            if (daysActive <= 5 && currentMonthTopup >= MINIMUM_CONTRIBUTION) return 'EARLY_BIRD';
            if (avgDeposit > MINIMUM_CONTRIBUTION * 2) return 'BIG_DEPOSITOR';
            if (currentMonthTopup >= MINIMUM_CONTRIBUTION) {
                const variance = Math.abs(currentMonthTopup - avgDeposit) / (avgDeposit || 1);
                return variance < 0.15 ? 'STEADY_CONTRIBUTOR' : 'STEADY_CLIMBER';
            }
            return 'STEADY_CLIMBER';
        }

function formatArchetypeMessage(archetype, memberData, allMembersData, currentMonth) {
            try {
                const messages = ARCHETYPE_MESSAGES[archetype] || ARCHETYPE_MESSAGES.STEADY_CLIMBER;
                let available = messages;
                const monthIndex = MONTHS.indexOf(currentMonth);
                if (monthIndex === 0) {
                    const trendTypes = ['LATE_BLOOMER','ACCELERATOR','DECELERATOR','VOLATILE'];
                    if (trendTypes.includes(archetype)) {
                        available = messages.filter(m => !m.text.includes('{previousMonthTopup}') && !m.text.includes('{previousInterest}'));
                        if (!available.length) available = ARCHETYPE_MESSAGES.STEADY_CLIMBER;
                    }
                }
                const msg = available[Math.floor(Math.random() * available.length)];
                const monthsElapsed   = monthIndex + 1;
                const monthsRemaining = 12 - monthsElapsed;
                const avgDeposit      = monthsElapsed > 0 ? (memberData.totalTopups || 0) / monthsElapsed : 0;
                const projected       = (memberData.closingBalance || 0) + (avgDeposit * monthsRemaining);
                const stretchGoal     = (memberData.closingBalance || 0) + ((avgDeposit * 1.5) * monthsRemaining);
                const suggestedNext   = Math.round((memberData.currentMonthTopup || 0) * 1.2);
                const prevTopup       = memberData.previousMonthTopup || 0;
                const balanceIncrease = prevTopup > 0 ? Math.round(((memberData.currentMonthTopup - prevTopup) / prevTopup) * 100) : 0;
                const estimatedInterest = ((memberData.closingBalance||0) + (avgDeposit*monthsRemaining)) * ETICA_MONTHLY_YIELD * monthsRemaining;
                const shareOfTotal    = allMembersData.length > 0 ? Math.round(((memberData.closingBalance||0) / allMembersData.reduce((s,m)=>s+(m.closingBalance||0),0))*100) : 0;
                const lateStart       = MINIMUM_CONTRIBUTION * monthsRemaining + (MINIMUM_CONTRIBUTION * monthsRemaining * ETICA_MONTHLY_YIELD * (monthsRemaining/2));
                let text = msg.text
                    .replace(/{projected}/g,           `KES ${Math.round(projected).toLocaleString()}`)
                    .replace(/{stretchGoal}/g,         `KES ${Math.round(stretchGoal).toLocaleString()}`)
                    .replace(/{totalTopups}/g,         `KES ${(memberData.totalTopups||0).toLocaleString()}`)
                    .replace(/{currentMonthTopup}/g,   `KES ${(memberData.currentMonthTopup||0).toLocaleString()}`)
                    .replace(/{previousMonthTopup}/g,  `KES ${prevTopup.toLocaleString()}`)
                    .replace(/{interest}/g,            `KES ${(memberData.totalInterest||0).toLocaleString()}`)
                    .replace(/{currentInterest}/g,     `KES ${(memberData.currentInterest||0).toLocaleString()}`)
                    .replace(/{avgDeposit}/g,          `KES ${Math.round(avgDeposit).toLocaleString()}`)
                    .replace(/{monthsLeft}/g,          monthsRemaining.toString())
                    .replace(/{minimum}/g,             `KES ${MINIMUM_CONTRIBUTION.toLocaleString()}`)
                    .replace(/{gapToMinimum}/g,        `KES ${Math.max(0, MINIMUM_CONTRIBUTION-(memberData.currentMonthTopup||0)).toLocaleString()}`)
                    .replace(/{currentBalance}/g,      `KES ${(memberData.closingBalance||0).toLocaleString()}`)
                    .replace(/{suggestedNextDeposit}/g,`KES ${suggestedNext.toLocaleString()}`)
                    .replace(/{balanceIncrease}/g,     balanceIncrease.toString())
                    .replace(/{percentIncrease}/g,     balanceIncrease.toString())
                    .replace(/{similarMembers}/g,      (Math.floor(Math.random()*5)+3).toString())
                    .replace(/{shareOfTotal}/g,        shareOfTotal.toString())
                    .replace(/{projectedInterest}/g,   `KES ${Math.round(estimatedInterest).toLocaleString()}`)
                    .replace(/{lateStartProjection}/g, `KES ${Math.round(lateStart).toLocaleString()}`)
                    .replace(/\*\*/g, '');
                return { icon: msg.icon, text };
            } catch(e) {
                return { icon: 'üìä', text: `You're on track for KES ${Math.round((memberData.closingBalance||0)+40000).toLocaleString()} by December. Keep going!` };
            }
        }

// ‚îÄ‚îÄ‚îÄ PASSWORD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function PwScreen({onOK}) {
  const [pw, setPw]   = useState('');
  const [err, setErr] = useState('');
  const [shk, setShk] = useState(false);
  const go = e => {
    e.preventDefault();
    if (pw === PASSWORD) { setAuth(); onOK(); }
    else {
      setErr('Wrong password. Ask your group admin.');
      setShk(true); setTimeout(()=>setShk(false),500); setPw('');
    }
  };
  return (
    <div className="pw-screen">
      <div className="pw-card" style={{animation: shk ? 'shk .5s' : undefined}}>
        <div style={{fontSize:'2.2rem'}}>&#128274;</div>
        <div className="pw-title">Like-Minded Folks</div>
        <div className="pw-sub">MMF Account Tracker ¬∑ Members Only</div>
        <form onSubmit={go} style={{width:'100%',display:'flex',flexDirection:'column',gap:8}}>
          <input type="password" value={pw} onChange={e=>setPw(e.target.value)}
            placeholder="Enter password" autoFocus
            className={`pw-inp${err?' err':''}`} />
          <div className="pw-err">{err}</div>
          <button type="submit" className="pw-btn">Access Tracker &#8594;</button>
        </form>
        <div className="pw-help">No password? Contact your group admin</div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ MEMBER CHART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function MemberChart({alias, data, month, theme}) {
  const ref = useRef(null), inst = useRef(null);
  useEffect(() => {
    if (!ref.current || !data || !alias) return;
    if (inst.current) inst.current.destroy();
    const ctx = ref.current.getContext('2d');
    const idx = MONTHS.indexOf(month);
    let total = 0;
    const deps=[], bals=[];
    for (let i=0; i<=idx; i++) {
      const md = data[MONTHS[i]]?.[alias]||{};
      deps.push(md.topups||0); bals.push(md.closingBalance||0);
      total += md.topups||0;
    }
    const avg = (idx+1) > 0 ? total/(idx+1) : MIN_CONTRIB;
    const barD  = [...deps, ...Array(11-idx).fill(null)];
    const barC  = deps.map(v => v>=MIN_CONTRIB?'rgba(0,200,122,.78)':v>0?'rgba(245,158,11,.78)':'rgba(239,68,68,.55)').concat(Array(11-idx).fill('transparent'));
    const balL  = [...bals, ...Array(11-idx).fill(null)];
    const last  = bals[bals.length-1]||0;
    const proj  = Array(12).fill(null); proj[idx]=last;
    for (let i=idx+1;i<12;i++) proj[i]=(proj[i-1]+avg)*(1+ETICA_MONTHLY);
    inst.current = new Chart(ctx, {
      data:{labels:MONTHS.map(m=>m.slice(0,3)), datasets:[
        {type:'bar',  label:'Monthly Deposit', data:barD, backgroundColor:barC, borderWidth:0, borderRadius:4, yAxisID:'y', order:3},
        {type:'line', label:'Balance to Date', data:balL, borderColor:'#00c87a', backgroundColor:'transparent', borderWidth:2.5, pointBackgroundColor:'#00c87a', pointRadius:4, fill:false, tension:.3, yAxisID:'y', order:1, spanGaps:false},
        {type:'line', label:'Projected',       data:proj, borderColor:'#3b82f6', backgroundColor:'transparent', borderWidth:2,   borderDash:[6,4], pointBackgroundColor:'#3b82f6', pointRadius:3, fill:false, tension:.3, yAxisID:'y', order:2, spanGaps:false}
      ]},
      options:{responsive:true, maintainAspectRatio:false,
        interaction:{mode:'index',intersect:false},
        plugins:{
          legend:{display:true,position:'top',labels:{color: document.documentElement.getAttribute('data-theme')==='light' ? 'rgba(30,40,60,.65)' : 'rgba(200,200,220,.55)',font:{size:10,family:'DM Sans'},boxWidth:10,padding:12}},
          tooltip:{backgroundColor:'#1e2232',titleColor:'#00c87a',bodyColor:'#eef0f8',borderColor:'rgba(0,200,122,.2)',borderWidth:1,
            callbacks:{label:c=>{const v=c.parsed.y; if(v===null||v===undefined)return null; return `${c.dataset.label}: KES ${Math.round(v).toLocaleString()}`;}}}
        },
        scales:{
          y:{beginAtZero:true, ticks:{color: document.documentElement.getAttribute('data-theme')==='light' ? 'rgba(30,40,60,.6)' : 'rgba(200,200,220,.5)',font:{size:9},callback:v=>'KES '+(v/1000).toFixed(0)+'k'}, grid:{color:'rgba(255,255,255,.04)'}},
          x:{ticks:{color: document.documentElement.getAttribute('data-theme')==='light' ? 'rgba(30,40,60,.6)' : 'rgba(200,200,220,.5)',font:{size:9}}, grid:{display:false}}
        }
      }
    });
    return () => { if(inst.current) inst.current.destroy(); };
  }, [alias, data, month, theme]);
  if (!alias) return null;
  return <div style={{height:'240px',position:'relative'}}><canvas ref={ref}/></div>;
}

// ‚îÄ‚îÄ‚îÄ GROUP CHART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function GroupChart({data, month, theme}) {
  const ref = useRef(null), inst = useRef(null);
  useEffect(() => {
    if (!ref.current || !data) return;
    if (inst.current) inst.current.destroy();
    const ctx = ref.current.getContext('2d');
    const idx = MONTHS.indexOf(month);
    let total = 0;
    const tots=[], bals=[];
    for (let i=0; i<=idx; i++) {
      let t=0,b=0;
      MEMBERS.forEach(a => { t+=data[MONTHS[i]]?.[a]?.topups||0; b+=data[MONTHS[i]]?.[a]?.closingBalance||0; });
      tots.push(t); bals.push(b); total+=t;
    }
    const avg  = (idx+1)>0 ? total/(idx+1) : 0;
    const barD = [...tots, ...Array(11-idx).fill(null)];
    const last = bals[bals.length-1]||0;
    const proj = Array(12).fill(null); proj[idx]=last;
    for (let i=idx+1;i<12;i++) proj[i]=(proj[i-1]+avg)*(1+ETICA_MONTHLY);
    inst.current = new Chart(ctx, {
      data:{labels:MONTHS.map(m=>m.slice(0,3)), datasets:[
        {type:'bar',  label:'Monthly Group Total', data:barD, backgroundColor:'rgba(0,200,122,.65)', borderWidth:0, borderRadius:4, yAxisID:'y', order:2},
        {type:'line', label:'Projected Balance',   data:proj, borderColor:'#3b82f6', backgroundColor:'transparent', borderWidth:2, borderDash:[6,4], pointBackgroundColor:'#3b82f6', pointRadius:3, fill:false, tension:.3, yAxisID:'y', order:1, spanGaps:false}
      ]},
      options:{responsive:true, maintainAspectRatio:false,
        interaction:{mode:'index',intersect:false},
        plugins:{
          legend:{display:true,position:'top',labels:{color: document.documentElement.getAttribute('data-theme')==='light' ? 'rgba(30,40,60,.65)' : 'rgba(200,200,220,.55)',font:{size:10,family:'DM Sans'},boxWidth:10,padding:12}},
          tooltip:{backgroundColor:'#1e2232',titleColor:'#00c87a',bodyColor:'#eef0f8',borderColor:'rgba(0,200,122,.2)',borderWidth:1,
            callbacks:{label:c=>{const v=c.parsed.y; if(v===null||v===undefined)return null; return `${c.dataset.label}: KES ${Math.round(v).toLocaleString()}`;}}}
        },
        scales:{
          y:{beginAtZero:true, ticks:{color: document.documentElement.getAttribute('data-theme')==='light' ? 'rgba(30,40,60,.6)' : 'rgba(200,200,220,.5)',font:{size:9},callback:v=>'KES '+(v/1000).toFixed(0)+'k'}, grid:{color:'rgba(255,255,255,.04)'}},
          x:{ticks:{color: document.documentElement.getAttribute('data-theme')==='light' ? 'rgba(30,40,60,.6)' : 'rgba(200,200,220,.5)',font:{size:9}}, grid:{display:false}}
        }
      }
    });
    return () => { if(inst.current) inst.current.destroy(); };
  }, [data, month, theme]);
  return <div style={{height:'220px',position:'relative'}}><canvas ref={ref}/></div>;
}

// ‚îÄ‚îÄ‚îÄ ALL MEMBERS VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function AllMembers({month, rows, ts, data, theme, onBack}) {
  const tO=rows.reduce((s,r)=>s+r.openingBalance,0);
  const tT=rows.reduce((s,r)=>s+r.topups,0);
  const tI=rows.reduce((s,r)=>s+r.interest,0);
  const tC=rows.reduce((s,r)=>s+r.closingBalance,0);
  const fmt = n => n.toLocaleString('en-KE',{maximumFractionDigits:0});
  return (
    <div className="inner">
      <button className="back-btn" onClick={onBack}>&#8592; Back to Overview</button>
      <div className="inner-title">Group Saving &amp; Interest &middot; {month}</div>
      <div className="ccrd">
        <div className="clbl">Group Monthly Totals &amp; Projection</div>
        <div className="csub"><span style={{color:'#00c87a'}}>&#9646;</span> Monthly &nbsp;&middot;&nbsp; <span style={{color:'#3b82f6'}}>&#8213;</span> Projected</div>
        <GroupChart data={data} month={month} theme={theme} />
      </div>
      <div className="mtbl-wrap">
        <table className="mtbl">
          <thead>
            <tr>
              <th className="tl" style={{width:'8%'}}>#</th>
              <th className="tl" style={{width:'20%'}}>Alias</th>
              <th className="nm" style={{width:'18%'}}>Opening</th>
              <th className="nm" style={{width:'18%'}}>Top-ups</th>
              <th className="nm" style={{width:'13%'}}>Int.</th>
              <th className="nm" style={{width:'23%'}}>Balance</th>
            </tr>
          </thead>
          <tbody>
            {rows.map((r,i) => {
              const dc = r.topups>=MIN_CONTRIB?'#00c87a':r.topups>0?'#f59e0b':'#ef4444';
              return (
                <tr key={r.alias}>
                  <td className="tl" style={{color:'var(--t3)',fontSize:'.72rem'}}>{i<3?['ü•á','ü•à','ü•â'][i]:i+1}</td>
                  <td className="tl" style={{fontWeight:600,color:'var(--t1)'}}>{r.alias}</td>
                  <td className="nm">{fmt(r.openingBalance)}</td>
                  <td className="nm"><div className="tcell">{fmt(r.topups)}<span className="dot" style={{backgroundColor:dc}}/></div></td>
                  <td className="nm">{fmt(r.interest)}</td>
                  <td className="nm ac">{fmt(r.closingBalance)}</td>
                </tr>
              );
            })}
            <tr className="tot">
              <td/><td className="tl">TOTALS</td>
              <td className="nm">{fmt(tO)}</td>
              <td className="nm">{fmt(tT)}</td>
              <td className="nm">{fmt(tI)}</td>
              <td className="nm ac">{fmt(tC)}</td>
            </tr>
          </tbody>
        </table>
      </div>
      {ts && <div className="dts">Data as of {ts.toLocaleString('en-KE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true})}</div>}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function App() {
  const [auth,    setAuth2]    = useState(() => !!getAuth());
  const [theme, setTheme] = useState(() => {
    // Check for manual override first; otherwise follow system
    const saved = localStorage.getItem('mmf_theme');
    if (saved) return saved;
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  });
  const [data,    setData]     = useState(null);
  const [loading, setLoading]  = useState(true);
  const [error,   setError]    = useState(null);
  const [tab,     setTab]      = useState('overview');
  const [month,   setMonth]    = useState(curMonth);
  const [alias,   setAlias]    = useState('');
  const [allView, setAllView]  = useState(false);
  const [ts,      setTs]       = useState(null);

  useEffect(() => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('mmf_theme', theme);
  }, [theme]);

  useEffect(() => { if (auth) load(); }, [auth]);

  const load = async () => {
    try {
      setLoading(true); setError(null);
      const parsed = {};
      const res = await Promise.all(MONTHS.map(async m => {
        const url  = MONTH_URLS[m];
        const resp = await fetch(url+'&_='+Date.now(), {cache:'no-store'});
        if (!resp.ok) throw new Error('Failed '+m);
        const txt  = await resp.text();
        const ls   = txt.split('\n').filter(l=>l.trim());
        const md   = {};
        for (let i=3; i<ls.length; i++) {
          const cols  = parseRow(ls[i]);
          const name  = cols[0]?.trim().replace(/"/g,'');
          if (name && MEMBERS.includes(name)) {
            const n = s => parseFloat((s||'').replace(/["',\s]/g,''))||0;
            md[name] = {
              openingBalance: n(cols[1]),
              topups:         n(cols[2]),
              interest:       n(cols[3]),
              daysActive:     parseInt((cols[4]||'').replace(/[",\s]/g,''))||0,
              closingBalance: n(cols[5])
            };
          }
        }
        return {m, md};
      }));
      res.forEach(({m,md}) => { parsed[m]=md; });
      setData(parsed); setTs(new Date()); setLoading(false);
    } catch(e) {
      setError('Could not load data. Please refresh.'); setLoading(false);
    }
  };

  const getRows = useCallback(m => {
    if (!data) return [];
    return MEMBERS.map(a => ({alias:a,...(data[m]?.[a]||{openingBalance:0,topups:0,interest:0,daysActive:0,closingBalance:0})}))
      .sort((a,b)=>b.closingBalance-a.closingBalance);
  }, [data]);

  const stats = useCallback(() => {
    if (!data) return null;
    const rows = getRows(month);
    const mTopups = rows.reduce((s,r)=>s+r.topups,0);
    const mInt    = rows.reduce((s,r)=>s+r.interest,0);
    const totBal  = rows.reduce((s,r)=>s+r.closingBalance,0);
    const idx = MONTHS.indexOf(month);
    let cumC=0,cumI=0;
    for (let i=0;i<=idx;i++) {
      if (data[MONTHS[i]]) {
        const rr=getRows(MONTHS[i]);
        cumC+=rr.reduce((s,r)=>s+r.topups,0);
        cumI+=rr.reduce((s,r)=>s+r.interest,0);
      }
    }
    return {mTopups,mInt,cumC,cumI,totBal};
  }, [data, month, getRows]);

  if (!auth) return <PwScreen onOK={() => setAuth2(true)} />;

  if (loading) return (
    <div className="lscreen">
      <div className="spin"/>
      <div>Loading your data&hellip;</div>
    </div>
  );

  if (error) return (
    <div className="lscreen">
      <div style={{fontSize:'1.5rem'}}>&#9888;&#65039;</div>
      <div style={{color:'var(--rd)',textAlign:'center',padding:'0 32px'}}>{error}</div>
      <button onClick={load} className="pw-btn" style={{width:'auto',padding:'10px 24px'}}>Retry</button>
    </div>
  );

  const st      = stats();
  const cm      = curMonth();
  const today   = new Date().getDate();
  const md      = data?.[month]?.[alias]||{openingBalance:0,topups:0,interest:0,daysActive:0,closingBalance:0};
  const partner = PAIRS[alias];
  const f2 = n => n.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2});
  const f0 = n => n.toLocaleString('en-KE',{maximumFractionDigits:0});

  let warn='', warnMsg='';
  if (month===cm && today>=WARN_START_DAY && alias) {
    if (partner) {
      const pd=data[month]?.[partner]||{topups:0};
      const comb=md.topups+pd.topups;
      if (comb===0) { warn=true; warnMsg=`Combined ${month} contribution with ${partner} not recorded yet.`; }
      else if (comb<MIN_CONTRIB) {
        warn=true;
        const fn=PARTIAL_CONTRIBUTION_MESSAGES[Math.floor(Math.random()*PARTIAL_CONTRIBUTION_MESSAGES.length)];
        warnMsg=fn(comb,MIN_CONTRIB-comb)+` (Combined with ${partner})`;
      }
    } else {
      if (md.topups===0) { warn=true; warnMsg=`${month} contribution not recorded yet. Deposit KES ${MIN_CONTRIB.toLocaleString()} soon.`; }
      else if (md.topups<MIN_CONTRIB) {
        warn=true;
        const fn=PARTIAL_CONTRIBUTION_MESSAGES[Math.floor(Math.random()*PARTIAL_CONTRIBUTION_MESSAGES.length)];
        warnMsg=fn(md.topups,MIN_CONTRIB-md.topups);
      }
    }
  }

  let motiv = {icon:'üìä',text:'Keep going!'};
  if (alias && data) {
    const idx=MONTHS.indexOf(month);
    const hist={totalTopups:0,totalInterest:0,currentMonthTopup:0,currentInterest:0,previousMonthTopup:0,closingBalance:0,daysActive:0};
    for (let i=0;i<=idx;i++) {
      const m2=data[MONTHS[i]]?.[alias]||{};
      hist.totalTopups+=m2.topups||0; hist.totalInterest+=m2.interest||0;
      if (i===idx) { hist.currentMonthTopup=m2.topups||0; hist.currentInterest=m2.interest||0; hist.closingBalance=m2.closingBalance||0; hist.daysActive=m2.daysActive||0; }
      if (i===idx-1) hist.previousMonthTopup=m2.topups||0;
    }
    const allMD=MEMBERS.map(a=>({alias:a,closingBalance:data[month]?.[a]?.closingBalance||0}));
    const arch=calculateMemberArchetype(hist,allMD,month);
    motiv=formatArchetypeMessage(arch,hist,allMD,month);
  }


  const openContrib = () => {
    const b64='PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgbWF4aW11bS1zY2FsZT0xLjAsIHVzZXItc2NhbGFibGU9bm8iPgogICAgPHRpdGxlPkxNRiBDb250cmlidXRpb24vRGVwb3NpdCBUcmFja2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAqIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ1NlZ29lIFVJJywgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMzsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI2xvYWRpbmcgewogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIGNvbG9yOiAjNjY2OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjZXJyb3IgewogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgICAgICBjb2xvcjogI2QzMmYyZjsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhYmxlLWNvbnRhaW5lciB7CiAgICAgICAgICAgIHdpZHRoOiAxMDB2dzsKICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG87CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRhYmxlIHsKICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICAgICAgICAgICAgd2lkdGg6IG1heC1jb250ZW50OwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRoLCB0ZCB7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCAzcHg7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgYm9yZGVyOiAwLjVweCBzb2xpZCAjZDBkMGQwOwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEluY3JlYXNlIGZvbnQgc2l6ZSBmb3IgZGF0YSByb3dzICh0Ym9keSkgKi8KICAgICAgICB0Ym9keSB0ZCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogRmlyc3QgdGhyZWUgY29sdW1ucyAtIGZyb3plbiBhbmQgY29tcGFjdCAqLwogICAgICAgIHRoOm50aC1jaGlsZCgxKSwKICAgICAgICB0ZDpudGgtY2hpbGQoMSkgewogICAgICAgICAgICBwb3NpdGlvbjogc3RpY2t5OwogICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogICAgICAgICAgICB6LWluZGV4OiA1OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICAgICAgICB3aWR0aDogYXV0bzsKICAgICAgICAgICAgbWluLXdpZHRoOiAzMHB4OwogICAgICAgICAgICBtYXgtd2lkdGg6IDV2dzsKICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4OwogICAgICAgICAgICBwYWRkaW5nOiA0cHggM3B4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBJbmNyZWFzZSBmb250IHNpemUgZm9yIHRib2R5IGNlbGxzIGluIGNvbHVtbiAxICovCiAgICAgICAgdGJvZHkgdGQ6bnRoLWNoaWxkKDEpIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0aDpudGgtY2hpbGQoMiksCiAgICAgICAgdGQ6bnRoLWNoaWxkKDIpIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgbGVmdDogdmFyKC0tY29sMS13aWR0aCwgNXZ3KTsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZhZmFmYTsKICAgICAgICAgICAgei1pbmRleDogNTsKICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgICAgICAgd2lkdGg6IGF1dG87CiAgICAgICAgICAgIG1pbi13aWR0aDogODBweDsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxNnZ3OwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCAzcHg7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7CiAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSW5jcmVhc2UgZm9udCBzaXplIGZvciB0Ym9keSBjZWxscyBpbiBjb2x1bW4gMiAqLwogICAgICAgIHRib2R5IHRkOm50aC1jaGlsZCgyKSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdGg6bnRoLWNoaWxkKDMpLAogICAgICAgIHRkOm50aC1jaGlsZCgzKSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICAgICAgICAgIGxlZnQ6IHZhcigtLWNvbDItd2lkdGgsIDIxdncpOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogICAgICAgICAgICB6LWluZGV4OiA1OwogICAgICAgICAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgICAgICAgICAgd2lkdGg6IGF1dG87CiAgICAgICAgICAgIG1pbi13aWR0aDogODBweDsKICAgICAgICAgICAgbWF4LXdpZHRoOiBjYWxjKDMzLjMzdncgLSB2YXIoLS1jb2wxLXdpZHRoLCA1dncpIC0gdmFyKC0tY29sMi13aWR0aCwgMjF2dykgKyA1dncgKyAxNnZ3KTsKICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4OwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEluY3JlYXNlIGZvbnQgc2l6ZSBmb3IgdGJvZHkgY2VsbHMgaW4gY29sdW1uIDMgKi8KICAgICAgICB0Ym9keSB0ZDpudGgtY2hpbGQoMykgewogICAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEhlYWRlciByb3dzIHN0aWNreSAqLwogICAgICAgIHRoZWFkIHRyIHRoIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y1ZjVmNTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgei1pbmRleDogMTA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEZpcnN0IHRocmVlIGNvbHVtbiBoZWFkZXJzIGhpZ2hlciB6LWluZGV4ICovCiAgICAgICAgdGhlYWQgdHIgdGg6bnRoLWNoaWxkKDEpLAogICAgICAgIHRoZWFkIHRyIHRoOm50aC1jaGlsZCgyKSwKICAgICAgICB0aGVhZCB0ciB0aDpudGgtY2hpbGQoMykgewogICAgICAgICAgICB6LWluZGV4OiAxNTsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZhZmFmYTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUm93IDEgLSBXZWVrIG51bWJlcnMgKi8KICAgICAgICB0aGVhZCB0cjpudGgtY2hpbGQoMSkgdGggewogICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUm93IDIgLSBNb250aHMgKG1lcmdlZCBjZWxscykgKi8KICAgICAgICB0aGVhZCB0cjpudGgtY2hpbGQoMikgdGggewogICAgICAgICAgICB0b3A6IDI0cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUm93IDMgLSBEYXRlcyB3aXRoIHdyYXBwaW5nICovCiAgICAgICAgdGhlYWQgdHI6bnRoLWNoaWxkKDMpIHRoIHsKICAgICAgICAgICAgdG9wOiA0OHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm9ybWFsOwogICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDJweDsKICAgICAgICAgICAgaGVpZ2h0OiAzNnB4OwogICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDA0MjNlICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogRGF0ZSByb3cgLSBmaXJzdCB0aHJlZSBjb2x1bW5zIGFsc28gZ2V0IHRoZSBjb2xvciAqLwogICAgICAgIHRoZWFkIHRyOm50aC1jaGlsZCgzKSB0aDpudGgtY2hpbGQoMSksCiAgICAgICAgdGhlYWQgdHI6bnRoLWNoaWxkKDMpIHRoOm50aC1jaGlsZCgyKSwKICAgICAgICB0aGVhZCB0cjpudGgtY2hpbGQoMykgdGg6bnRoLWNoaWxkKDMpIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzAwNDIzZSAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBCYW5kZWQgcm93cyAtIGFsdGVybmF0aW5nIGNvbG9ycyAqLwogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChldmVuKSB0ZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNkY2U2ZjE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChvZGQpIHRkIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogQXBwbHkgYmFuZGVkIGNvbG9ycyB0byBmcm96ZW4gY29sdW1ucyB0b28gKi8KICAgICAgICB0Ym9keSB0cjpudGgtY2hpbGQoZXZlbikgdGQ6bnRoLWNoaWxkKDEpLAogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChldmVuKSB0ZDpudGgtY2hpbGQoMiksCiAgICAgICAgdGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4pIHRkOm50aC1jaGlsZCgzKSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNkY2U2ZjE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChvZGQpIHRkOm50aC1jaGlsZCgxKSwKICAgICAgICB0Ym9keSB0cjpudGgtY2hpbGQob2RkKSB0ZDpudGgtY2hpbGQoMiksCiAgICAgICAgdGJvZHkgdHI6bnRoLWNoaWxkKG9kZCkgdGQ6bnRoLWNoaWxkKDMpIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogTnVtYmVyIGFsaWdubWVudCBhbmQgZm9ybWF0dGluZyAqLwogICAgICAgIHRkLm51bWJlciB7CiAgICAgICAgICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgICAgICAgICBmb250LXZhcmlhbnQtbnVtZXJpYzogdGFidWxhci1udW1zOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBUT1RBTCByb3cgc3R5bGluZyAqLwogICAgICAgIHRib2R5IHRyLnRvdGFsLXJvdyB0ZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMwMDIzNTEgIWltcG9ydGFudDsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBDb21wYWN0IGRhdGEgY29sdW1ucyAqLwogICAgICAgIHRoOm5vdCg6bnRoLWNoaWxkKDEpKTpub3QoOm50aC1jaGlsZCgyKSk6bm90KDpudGgtY2hpbGQoMykpLAogICAgICAgIHRkOm5vdCg6bnRoLWNoaWxkKDEpKTpub3QoOm50aC1jaGlsZCgyKSk6bm90KDpudGgtY2hpbGQoMykpIHsKICAgICAgICAgICAgbWluLXdpZHRoOiA1MHB4OwogICAgICAgICAgICBtYXgtd2lkdGg6IDY1cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTFweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSW5jcmVhc2UgZm9udCBzaXplIGZvciB0Ym9keSBkYXRhIGNlbGxzICovCiAgICAgICAgdGJvZHkgdGQ6bm90KDpudGgtY2hpbGQoMSkpOm5vdCg6bnRoLWNoaWxkKDIpKTpub3QoOm50aC1jaGlsZCgzKSkgewogICAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIExvYWRpbmcgc3Bpbm5lciAqLwogICAgICAgIC5zcGlubmVyIHsKICAgICAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI2YzZjNmMzsKICAgICAgICAgICAgYm9yZGVyLXRvcDogM3B4IHNvbGlkICMzNDk4ZGI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgd2lkdGg6IDMwcHg7CiAgICAgICAgICAgIGhlaWdodDogMzBweDsKICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgbWFyZ2luOiAyMHB4IGF1dG87CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEBrZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7IH0KICAgICAgICAgICAgMTAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSGVhZGVyIHRpdGxlICovCiAgICAgICAgLnBhZ2UtaGVhZGVyIHsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBwYWRkaW5nOiAxNXB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDA0MjNlOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgei1pbmRleDogMjA7CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxkaXYgY2xhc3M9InBhZ2UtaGVhZGVyIj5MTUYgQ29udHJpYnV0aW9uL0RlcG9zaXQgVHJhY2tlcjwvZGl2PgogICAgPGRpdiBpZD0ibG9hZGluZyI+CiAgICAgICAgPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+CiAgICAgICAgPHA+TG9hZGluZyBkYXRhLi4uPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJlcnJvciI+PC9kaXY+CiAgICA8ZGl2IGlkPSJ0YWJsZUNvbnRhaW5lciIgY2xhc3M9InRhYmxlLWNvbnRhaW5lciIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij48L2Rpdj4KCiAgICA8c2NyaXB0PgogICAgICAgIGNvbnN0IENTVl9VUkwgPSAnaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlFmUWRCVmwwMWN4c0lvR25mSkxsdEdEdU9rSVZERnFqLXJOZzNLd0ZWWjgtR0diVXFrMURTc19DVmF5Z2lzamFMaGczMGcxZ2p6SXNkQy9wdWI/Z2lkPTIwNzk0NTMwMTYmc2luZ2xlPXRydWUmb3V0cHV0PWNzdic7CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gcGFyc2VDU1YodGV4dCkgewogICAgICAgICAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSBbXTsKICAgICAgICAgICAgbGV0IGN1cnJlbnRGaWVsZCA9ICcnOwogICAgICAgICAgICBsZXQgaW5RdW90ZXMgPSBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgY2hhciA9IHRleHRbaV07CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IHRleHRbaSArIDFdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gJyInKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluUXVvdGVzICYmIG5leHRDaGFyID09PSAnIicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEZpZWxkICs9ICciJzsKICAgICAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluUXVvdGVzID0gIWluUXVvdGVzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gJywnICYmICFpblF1b3RlcykgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lLnB1c2goY3VycmVudEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RmllbGQgPSAnJzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGNoYXIgPT09ICdcbicgfHwgY2hhciA9PT0gJ1xyJykgJiYgIWluUXVvdGVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWVsZCB8fCBjdXJyZW50TGluZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lLnB1c2goY3VycmVudEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMucHVzaChjdXJyZW50TGluZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRGaWVsZCA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gJ1xyJyAmJiBuZXh0Q2hhciA9PT0gJ1xuJykgewogICAgICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RmllbGQgKz0gY2hhcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWVsZCB8fCBjdXJyZW50TGluZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50TGluZS5wdXNoKGN1cnJlbnRGaWVsZCk7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGN1cnJlbnRMaW5lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGxpbmVzOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBpc051bWVyaWModmFsdWUpIHsKICAgICAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS50cmltKCkgPT09ICcnKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IG51bSA9IHZhbHVlLnJlcGxhY2UoLywvZywgJycpOwogICAgICAgICAgICByZXR1cm4gIWlzTmFOKG51bSkgJiYgIWlzTmFOKHBhcnNlRmxvYXQobnVtKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGZvcm1hdE51bWJlcih2YWx1ZSkgewogICAgICAgICAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHZhbHVlLnJlcGxhY2UoLywvZywgJycpKTsKICAgICAgICAgICAgaWYgKGlzTmFOKG51bSkpIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtKS50b0xvY2FsZVN0cmluZygnZW4tVVMnKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGFibGUoZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YS5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBlbm91Z2ggZGF0YSBmb3VuZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTa2lwIGZpcnN0IDQgcm93cwogICAgICAgICAgICAvLyBSb3cgNSAoaW5kZXggNCkgPSBXZWVrIG51bWJlcnMKICAgICAgICAgICAgLy8gUm93IDYgKGluZGV4IDUpID0gTW9udGhzCiAgICAgICAgICAgIC8vIFJvdyA3IChpbmRleCA2KSA9IERhdGVzCiAgICAgICAgICAgIGNvbnN0IHdlZWtSb3cgPSBkYXRhWzRdOwogICAgICAgICAgICBjb25zdCBtb250aFJvdyA9IGRhdGFbNV07CiAgICAgICAgICAgIGNvbnN0IGRhdGVSb3cgPSBkYXRhWzZdOwogICAgICAgICAgICBjb25zdCBkYXRhUm93cyA9IGRhdGEuc2xpY2UoNykuZmlsdGVyKHJvdyA9PiByb3cuc29tZShjZWxsID0+IGNlbGwgJiYgY2VsbC50cmltKCkpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAgICAgY29uc3QgdGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgICAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgd2VlayBudW1iZXIgcm93CiAgICAgICAgICAgIGNvbnN0IHdlZWtUciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgIC8vIEFkZCBibGFuayBjZWxscyBmb3IgZmlyc3QgdGhyZWUgY29sdW1ucwogICAgICAgICAgICBjb25zdCBibGFua1dlZWsxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgICAgICAgICAgY29uc3QgYmxhbmtXZWVrMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgIGNvbnN0IGJsYW5rV2VlazMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICBibGFua1dlZWszLnRleHRDb250ZW50ID0gJ1dFRUsgTk8uJzsKICAgICAgICAgICAgYmxhbmtXZWVrMy5zdHlsZS5jb2xvciA9ICdibGFjayc7CiAgICAgICAgICAgIGJsYW5rV2VlazMuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJzsKICAgICAgICAgICAgd2Vla1RyLmFwcGVuZENoaWxkKGJsYW5rV2VlazEpOwogICAgICAgICAgICB3ZWVrVHIuYXBwZW5kQ2hpbGQoYmxhbmtXZWVrMik7CiAgICAgICAgICAgIHdlZWtUci5hcHBlbmRDaGlsZChibGFua1dlZWszKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAzOyBpIDwgd2Vla1Jvdy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICAgICAgdGgudGV4dENvbnRlbnQgPSB3ZWVrUm93W2ldIHx8ICcnOwogICAgICAgICAgICAgICAgd2Vla1RyLmFwcGVuZENoaWxkKHRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGVhZC5hcHBlbmRDaGlsZCh3ZWVrVHIpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ3JlYXRlIG1vbnRoIHJvdyB3aXRoIG1lcmdlZCBjZWxscwogICAgICAgICAgICBjb25zdCBtb250aFRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgLy8gQWRkIGJsYW5rIGNlbGxzIGZvciBmaXJzdCB0aHJlZSBjb2x1bW5zCiAgICAgICAgICAgIGNvbnN0IGJsYW5rTW9udGgxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgICAgICAgICAgY29uc3QgYmxhbmtNb250aDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICBjb25zdCBibGFua01vbnRoMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgIGJsYW5rTW9udGgzLnRleHRDb250ZW50ID0gJ01PTlRIJzsKICAgICAgICAgICAgYmxhbmtNb250aDMuc3R5bGUuY29sb3IgPSAnYmxhY2snOwogICAgICAgICAgICBibGFua01vbnRoMy5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwogICAgICAgICAgICBtb250aFRyLmFwcGVuZENoaWxkKGJsYW5rTW9udGgxKTsKICAgICAgICAgICAgbW9udGhUci5hcHBlbmRDaGlsZChibGFua01vbnRoMik7CiAgICAgICAgICAgIG1vbnRoVHIuYXBwZW5kQ2hpbGQoYmxhbmtNb250aDMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVHJhY2sgbWVyZ2VkIG1vbnRoIGNlbGxzCiAgICAgICAgICAgIGxldCBpID0gMzsKICAgICAgICAgICAgd2hpbGUgKGkgPCBtb250aFJvdy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoVmFsdWUgPSBtb250aFJvd1tpXSB8fCAnJzsKICAgICAgICAgICAgICAgIGxldCBjb2xzcGFuID0gMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ291bnQgY29uc2VjdXRpdmUgY2VsbHMgd2l0aCBzYW1lIG1vbnRoCiAgICAgICAgICAgICAgICB3aGlsZSAoaSArIGNvbHNwYW4gPCBtb250aFJvdy5sZW5ndGggJiYgbW9udGhSb3dbaSArIGNvbHNwYW5dID09PSBtb250aFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgY29sc3BhbisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgICAgICB0aC50ZXh0Q29udGVudCA9IG1vbnRoVmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoY29sc3BhbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aC5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1vbnRoVHIuYXBwZW5kQ2hpbGQodGgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpICs9IGNvbHNwYW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhlYWQuYXBwZW5kQ2hpbGQobW9udGhUcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgZGF0ZSByb3cKICAgICAgICAgICAgY29uc3QgZGF0ZVRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgLy8gQWRkIGJsYW5rIGNlbGxzIGZvciBmaXJzdCB0aHJlZSBjb2x1bW5zCiAgICAgICAgICAgIGNvbnN0IGJsYW5rRGF0ZTEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICBjb25zdCBibGFua0RhdGUyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgICAgICAgICAgY29uc3QgYmxhbmtEYXRlMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgIGJsYW5rRGF0ZTMudGV4dENvbnRlbnQgPSAnVE9UQUwnOwogICAgICAgICAgICBibGFua0RhdGUzLnN0eWxlLmNvbG9yID0gJ3doaXRlJzsKICAgICAgICAgICAgYmxhbmtEYXRlMy5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwogICAgICAgICAgICBkYXRlVHIuYXBwZW5kQ2hpbGQoYmxhbmtEYXRlMSk7CiAgICAgICAgICAgIGRhdGVUci5hcHBlbmRDaGlsZChibGFua0RhdGUyKTsKICAgICAgICAgICAgZGF0ZVRyLmFwcGVuZENoaWxkKGJsYW5rRGF0ZTMpOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDM7IGkgPCBkYXRlUm93Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgICAgICB0aC50ZXh0Q29udGVudCA9IGRhdGVSb3dbaV0gfHwgJyc7CiAgICAgICAgICAgICAgICBkYXRlVHIuYXBwZW5kQ2hpbGQodGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoZWFkLmFwcGVuZENoaWxkKGRhdGVUcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgZGF0YSByb3dzCiAgICAgICAgICAgIGRhdGFSb3dzLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIFRPVEFMIHJvdyAobG9vayBmb3IgIlRPVEFMIiBpbiBmaXJzdCBvciBzZWNvbmQgY29sdW1uKQogICAgICAgICAgICAgICAgY29uc3QgaXNUb3RhbCA9IChyb3dbMF0gJiYgcm93WzBdLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ1RPVEFMJykpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJvd1sxXSAmJiByb3dbMV0udG9VcHBlckNhc2UoKS5pbmNsdWRlcygnVE9UQUwnKSk7CiAgICAgICAgICAgICAgICBpZiAoaXNUb3RhbCkgewogICAgICAgICAgICAgICAgICAgIHRyLmNsYXNzTGlzdC5hZGQoJ3RvdGFsLXJvdycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1hdGgubWF4KHJvdy5sZW5ndGgsIHdlZWtSb3cubGVuZ3RoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJvd1tpXSB8fCAnJzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDb2x1bW4gMSAtIHRleHQgb25seQogICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICAvLyBDb2x1bW4gMiAtIHRleHQgd2l0aCB3cmFwcGluZyBhZnRlciAiLyIKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pbmNsdWRlcygnLycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJy8nLCAnL1xuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGQudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGQuc3R5bGUud2hpdGVTcGFjZSA9ICdwcmUtbGluZSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIENvbHVtbiAzIC0gbnVtYmVycyB3aXRoIGNvbW1hcywgbm8gZGVjaW1hbHMsIGJvbGQsIHJpZ2h0LWFsaWduZWQKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc051bWVyaWModmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC50ZXh0Q29udGVudCA9IGZvcm1hdE51bWJlcih2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJpZ2h0LWFsaWduZWQgYW5kIGJvbGQgKGFscmVhZHkgc3R5bGVkIGluIENTUykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXIgY29sdW1ucyAtIGNoZWNrIGlmIG51bWVyaWMKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTnVtZXJpYyh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gZm9ybWF0TnVtYmVyKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLmNsYXNzTGlzdC5hZGQoJ251bWJlcicpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGQudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0ci5hcHBlbmRDaGlsZCh0ZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQodGhlYWQpOwogICAgICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZCh0Ym9keSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFibGVDb250YWluZXInKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGFibGUpOwogICAgICAgICAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBkeW5hbWljIHdpZHRocyBmb3IgZmlyc3QgdGhyZWUgY29sdW1ucwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbDFDZWxscyA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkOm50aC1jaGlsZCgxKSwgdGg6bnRoLWNoaWxkKDEpJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjb2wyQ2VsbHMgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKCd0ZDpudGgtY2hpbGQoMiksIHRoOm50aC1jaGlsZCgyKScpOwogICAgICAgICAgICAgICAgY29uc3QgY29sM0NlbGxzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgndGQ6bnRoLWNoaWxkKDMpLCB0aDpudGgtY2hpbGQoMyknKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IG1heENvbDEgPSAwOwogICAgICAgICAgICAgICAgbGV0IG1heENvbDIgPSAwOwogICAgICAgICAgICAgICAgbGV0IG1heENvbDMgPSAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb2wxQ2VsbHMuZm9yRWFjaChjZWxsID0+IG1heENvbDEgPSBNYXRoLm1heChtYXhDb2wxLCBjZWxsLnNjcm9sbFdpZHRoKSk7CiAgICAgICAgICAgICAgICBjb2wyQ2VsbHMuZm9yRWFjaChjZWxsID0+IG1heENvbDIgPSBNYXRoLm1heChtYXhDb2wyLCBjZWxsLnNjcm9sbFdpZHRoKSk7CiAgICAgICAgICAgICAgICBjb2wzQ2VsbHMuZm9yRWFjaChjZWxsID0+IG1heENvbDMgPSBNYXRoLm1heChtYXhDb2wzLCBjZWxsLnNjcm9sbFdpZHRoKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFkZCBzb21lIHBhZGRpbmcKICAgICAgICAgICAgICAgIG1heENvbDEgKz0gODsKICAgICAgICAgICAgICAgIG1heENvbDIgKz0gODsKICAgICAgICAgICAgICAgIG1heENvbDMgKz0gODsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRW5zdXJlIHRvdGFsIGRvZXNuJ3QgZXhjZWVkIDMzLjMzdncKICAgICAgICAgICAgICAgIGNvbnN0IG1heFRvdGFsID0gd2luZG93LmlubmVyV2lkdGggKiAwLjMzMzM7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbCA9IG1heENvbDEgKyBtYXhDb2wyICsgbWF4Q29sMzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gbWF4VG90YWwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2FsZSA9IG1heFRvdGFsIC8gdG90YWw7CiAgICAgICAgICAgICAgICAgICAgbWF4Q29sMSAqPSBzY2FsZTsKICAgICAgICAgICAgICAgICAgICBtYXhDb2wyICo9IHNjYWxlOwogICAgICAgICAgICAgICAgICAgIG1heENvbDMgKj0gc2NhbGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgd2lkdGhzCiAgICAgICAgICAgICAgICBjb2wxQ2VsbHMuZm9yRWFjaChjZWxsID0+IGNlbGwuc3R5bGUud2lkdGggPSBtYXhDb2wxICsgJ3B4Jyk7CiAgICAgICAgICAgICAgICBjb2wyQ2VsbHMuZm9yRWFjaChjZWxsID0+IHsKICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLndpZHRoID0gbWF4Q29sMiArICdweCc7CiAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5sZWZ0ID0gbWF4Q29sMSArICdweCc7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbDNDZWxscy5mb3JFYWNoKGNlbGwgPT4gewogICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUud2lkdGggPSBtYXhDb2wzICsgJ3B4JzsKICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmxlZnQgPSAobWF4Q29sMSArIG1heENvbDIpICsgJ3B4JzsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2FkRGF0YSgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQ1NWX1VSTCk7CiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2g6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcGFyc2VDU1YodGV4dCk7CiAgICAgICAgICAgICAgICBjcmVhdGVUYWJsZShkYXRhKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgZGF0YTonLCBlcnJvcik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvcicpOwogICAgICAgICAgICAgICAgZXJyb3JEaXYudGV4dENvbnRlbnQgPSBgRXJyb3IgbG9hZGluZyBkYXRhOiAke2Vycm9yLm1lc3NhZ2V9LiBQdWxsIGRvd24gdG8gcmVmcmVzaC5gOwogICAgICAgICAgICAgICAgZXJyb3JEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTG9hZCBkYXRhIG9uIHBhZ2UgbG9hZAogICAgICAgIGxvYWREYXRhKCk7CiAgICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==';
    const bytes=atob(b64); const arr=new Uint8Array(bytes.length);
    for(let i=0;i<bytes.length;i++) arr[i]=bytes.charCodeAt(i);
    window.open(URL.createObjectURL(new Blob([arr],{type:'text/html'})),'_blank');
  };

  return (
    <div className="shell">

      {/* HEADER */}
      <div className="hdr">
        <div className="hdr-row">
          <div>
            <div className="eyebrow">MMF Tracker &middot; {CUR_YEAR}</div>
            <div className="title">Like-Minded Folks</div>
            <div className="subtitle">Contributions, interest &amp; projections</div>
          </div>
          <button className="sw" onClick={() => {
              const next = theme==='dark'?'light':'dark';
              setTheme(next);
              // Store override; user is intentionally overriding system setting
              localStorage.setItem('mmf_theme', next);
            }} aria-label={`Switch to ${theme==='dark'?'light':'dark'} mode`} title="Override display mode">
            <div className="knob">{theme==='dark'?'‚òÄÔ∏è':'üåô'}</div>
          </button>
        </div>
      </div>

      {/* GREETING */}
      <div className="greet">
        <div className="greet-line">{greetLine()}</div>
      </div>

      {/* PILL NAV */}
      <div className="nav-wrap">
        <div className="nav-track">
          {[['overview','Overview','tab-ov'],['balance','My Balance','tab-bl'],['more','More+','tab-mo']].map(([id,lbl,cls]) => (
            <button key={id} className={`tab ${cls}${tab===id?' on':''}`}
              onClick={() => { setTab(id); setAllView(false); }}>
              {lbl}
            </button>
          ))}
        </div>
      </div>

      {/* ‚ïê‚ïê OVERVIEW ‚ïê‚ïê */}
      <div className={`panel${tab==='overview'?' on':''}`}>
        {allView
          ? <AllMembers month={month} rows={getRows(month)} ts={ts} data={data} theme={theme} onBack={() => setAllView(false)} />
          : <>
              <div className="hero">
                <div className="hero-lbl">Group Contributions to Date &middot; Jan &ndash; {month}</div>
                <div className="hero-num">{st ? f2(st.cumC) : '‚Äî'}</div>
                <div className="hero-sub">
                  <span style={{color:'var(--t3)'}}>This month:</span>
                  <span className="hero-pill">&#8593; KES {st ? f2(st.mTopups) : '0.00'}</span>
                </div>
              </div>

              {/* Quick-action glass cards ‚Äî side by side */}
              <div className="qarow">
                <div className="qac qac1" onClick={openContrib}>
                  <div className="qac-ico">&#128200;</div>
                  <div className="qac-lbl">View Group Contributions</div>
                  <div className="qac-arr">&#8599;</div>
                </div>
                <div className="qac qac2" onClick={() => setAllView(true)}>
                  <div className="qac-ico">&#128176;</div>
                  <div className="qac-lbl">View Group Saving &amp; Interest</div>
                  <div className="qac-arr">&#8594;</div>
                </div>
              </div>

              {/* Group Performance card */}
              <div className="perf-card">
                <div className="perf-head">
                  <div className="perf-ico">&#9878;</div>
                  <div className="perf-title">Group Performance</div>
                </div>
                <div className="perf-nums">
                  <div className="perf-row">
                    <div className="perf-n int">{st ? f2(st.cumI) : '‚Äî'}</div>
                    <div className="perf-lbl">Interest Earned</div>
                  </div>
                  <div className="perf-div"/>
                  <div className="perf-row">
                    <div className="perf-n bal">{st ? f2(st.totBal) : '‚Äî'}</div>
                    <div className="perf-lbl">Total Group Balance</div>
                  </div>
                </div>
              </div>

              <div className="priv">&#128274; <strong>Members only.</strong> Do not share outside LMF.</div>
            </>
        }
      </div>

      {/* ‚ïê‚ïê MY BALANCE ‚ïê‚ïê */}
      <div className={`panel${tab==='balance'?' on':''}`}>
        <div className="bpad">
          <div className="mscroll">
            {MONTHS.map(m => (
              <button key={m} className={`mpill${month===m?' on':''}`} onClick={() => setMonth(m)}>
                {m.slice(0,3)}
              </button>
            ))}
          </div>

          <div className="acrd">
            <div className="albl">Who are you?</div>
            <select className="asel" value={alias} onChange={e => setAlias(e.target.value)}>
              <option value="" disabled>Select your alias&hellip;</option>
              {MEMBERS.map(a => <option key={a} value={a}>{a}</option>)}
            </select>
          </div>

          {alias ? <>
            <div className="scrd">
              <div className="s-alias">{alias}</div>
              <div className="s-month">{month} {CUR_YEAR}</div>
              <div className="srow">
                <span className="slbl">Opening Balance</span>
                <span className="sval">{f2(md.openingBalance)}</span>
              </div>
              <div className="srow">
                <span className="slbl">Top-ups</span>
                <span className="sval bl">{f2(md.topups)}</span>
              </div>
              <div className="srow">
                <span className="slbl">
                  Interest Earned
                  <div className="hint">Early deposits earn more</div>
                </span>
                <span className="sval gr">{f2(md.interest)}</span>
              </div>
              <div className="srow">
                <span className="slbl big">Current Balance</span>
                <span className="sval hero">{f2(md.closingBalance)}</span>
              </div>
              {ts && <div className="sts">Data as of {ts.toLocaleString('en-KE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true})}</div>}
            </div>

            {warn && (
              <div className="wcrd">
                <div style={{fontSize:'1.2rem',flexShrink:0}}>&#9888;&#65039;</div>
                <div>
                  <div className="wtitle">Friendly Reminder</div>
                  <div className="wbody">{warnMsg}</div>
                </div>
              </div>
            )}

            <div className="ccrd">
              <div className="clbl">Contributions &amp; Balance Growth</div>
              <div className="csub">
                <span style={{color:'#00c87a'}}>&#9646;</span> Top-ups &nbsp;
                <span style={{color:'#00c87a'}}>&#9135;</span> Balance &nbsp;
                <span style={{color:'#3b82f6'}}>&#8213;</span> Projected
              </div>
              <MemberChart alias={alias} data={data} month={month} theme={theme} />
            </div>

            <div className="mcrd">
              <div className="mico">{motiv.icon}</div>
              <div className="mtxt">{motiv.text}</div>
            </div>
          </> : (
            <div className="empty">
              <div style={{fontSize:'2rem',marginBottom:10}}>&#128070;</div>
              Select your alias above to see your balance and projection
            </div>
          )}
        </div>
      </div>

      {/* ‚ïê‚ïê MORE+ ‚ïê‚ïê */}
      <div className={`panel${tab==='more'?' on':''}`}>
        <div className="morepad">

          <div className="morecrd">
            <div className="morehead">&#128179; Make a Deposit</div>
            <div className="morebody">
              <div className="dep">
                <div className="dep-t">M-PESA</div>
                <div className="dep-i">Paybill: <strong>4096483</strong><br/>Account: <strong>308398M</strong></div>
              </div>
              <div className="dep">
                <div className="dep-t">Bank Deposit / Transfer</div>
                <div className="dep-i">
                  Bank: <strong>Equity Bank</strong><br/>
                  A/C Name: Etica Unit Trust Collection<br/>
                  A/C No: <strong>0180 28395 1027</strong><br/>
                  Reference: <strong>308398M</strong>
                </div>
                <div className="dep-w">&#9888;&#65039; Always indicate <strong>308398M</strong> on the Reference / Remarks section.</div>
              </div>
            </div>
          </div>

          <div className="morecrd">
            <div className="morehead">&#128220; Group Rules</div>
            <div className="morebody">
              <ul className="rlist">
                <li>Minimum contribution: <strong>KES 4,000/month</strong></li>
                <li>Interest only on months with full minimum</li>
                <li>Withdrawals in December (before Week 3)</li>
                <li>Fund: <strong>Etica MMF</strong></li>
                <li>Maximum members: <strong>15</strong></li>
              </ul>
            </div>
          </div>

          <div className="morecrd">
            <div className="morehead">&#128196; Etica Monthly Statements</div>
            <div className="morebody">
              <div className="pdf-pw">PDF Password: 308398</div>
              <select className="ssel" onChange={e => {
                if (!e.target.value) return;
                const m = e.target.value;
                alert(['The '+m+' statement is still being prepared. Check back soon!',
                       m+' numbers are being finalised. Almost ready!'][Math.floor(Math.random()*2)]);
                e.target.value='';
              }}>
                <option value="">&#128229; Select Month to Download</option>
                {MONTHS.map(m => <option key={m} value={m}>{m}</option>)}
              </select>
            </div>
          </div>

        </div>
      </div>

    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
